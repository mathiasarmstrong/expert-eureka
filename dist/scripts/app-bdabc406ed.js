/******/!function(t){function e(n){if(o[n])return o[n].exports;var r=o[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}// webpackBootstrap
/******/
var o={};return e.m=t,e.c=o,e.p="",e(0)}([function(t,e,o){"use strict";var n=o(1),r=o(2);angular.module("codeChallenge",["uiGmapgoogle-maps","xml","ngAnimate","ngCookies","ngTouch","ngSanitize","ngMessages","ngAria","ngResource","ui.router","ui.bootstrap","toastr"]).config(n.routerConfig).controller("MainController",r.MainController)},function(t,e){"use strict";function o(t,e){"ngInject";t.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainController",controllerAs:"main"}),e.otherwise("/")}o.$inject=["$stateProvider","$urlRouterProvider"],Object.defineProperty(e,"__esModule",{value:!0}),e.routerConfig=o},function(t,e){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=Array.prototype.slice,r=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),a=void 0,i=void 0,s=void 0,c=void 0,u=void 0,l=void 0,d="http://webservices.nextbus.com/service/publicXMLFeed",p=function(){function t(e,r,d,p,h,g){"ngInject";var f=this;o(this,t);var m=n.call(arguments);a=m[0],i=m[1],s=m[2],c=m[3],u=m[4],l=m[5],this.routes=[],this.chosenRoute="";var v=960,b=900,j=1;this.muni={},this.path=d3.geo.path(),this.projection=d3.geo.mercator(),this.zoom=d3.behavior.zoom().translate([0,150]).scale(j).scaleExtent([.95*j,8*j]).on("zoom",function(){return f.zoomed()});var _=d3.select("#map").append("svg").attr("width",v).attr("height",b).append("g");this.g=_.append("g"),_.append("rect").attr("class","overlay").attr("width",v).attr("height",b),_.call(this.zoom).call(this.zoom.event),this.createMap(),this.getMyLocation(),this.getRoutes()}return t.$inject=["$scope","$http","x2js","$filter","$timeout","$log"],r(t,[{key:"getRoutes",value:function(){var t=this;i.get(d,{params:{command:"routeList",a:"sf-muni"}}).then(function(e){t.xmlRoutes=s.xml_str2json(e.data).body.route,t.getLocations()})}},{key:"getLocations",value:function(){var t=this;l.log("call started"),_.each(this.xmlRoutes,function(e){e._tag&&i.get(d,{params:{command:"vehicleLocations",a:"sf-muni",r:e._tag}}).then(function(e){_.each(s.xml_str2json(e.data).body,function(e){var o=e;return _.isArray(e)||e._id?void(_.isArray(e)?_.each(o,function(e){e._lon,e._lat&&(t.createDot([e._lon,e._lat],"b"+e._id,"red","2px",e.hidden),t.muni["b"+e._id]=e)}):(t.createDot([o._lon,o._lat],"b"+o._id,"red","2px",o.hidden),t.muni["b"+o._id]=o)):null}),t.routes=_(t.muni).map(function(t){return t._routeTag}).uniq().compact().value()})}),u(function(){t.getLocations()},13e3)}},{key:"createMap",value:function(){var t=this;d3.json("app/main/sf.json",function(e,o){if(e)return l.error(e);var n=topojson.feature(o,o.objects.neighborhoods),r=d3.geo.bounds(n),a=d3.sum(r,function(t){return t[0]})/2,i=d3.sum(r,function(t){return t[1]})/2;t.projection.scale(27e4).center([a,i]),t.path.projection(t.projection),t.g.selectAll("g").data(topojson.feature(o,o.objects.arteries).features).enter().append("path").attr("class","artery").attr("d",t.path),t.g.selectAll("g").data(topojson.feature(o,o.objects.neighborhoods).features).enter().append("path").attr("class","neighborhood").attr("d",t.path),t.g.selectAll("g").data(topojson.feature(o,o.objects.freeways).features).enter().append("path").attr("class","neighborhood").attr("d",t.path),t.g.selectAll("g").data(topojson.feature(o,o.objects.streets).features).enter().append("path").attr("class","neighborhood").attr("d",t.path)})}},{key:"createDot",value:function(t,e){var o=this,n=arguments.length<=2||void 0===arguments[2]?"red":arguments[2],r=arguments.length<=3||void 0===arguments[3]?"2px":arguments[3];this.muni[e]?this.g.selectAll("circle#"+e).transition().duration(13e3).attr("cx",function(e){return o.projection(t)[0]}).attr("cy",function(e){return o.projection(t)[1]}):this.g.selectAll("g").data([t]).enter().append("circle").attr("cx",function(t){return o.projection(t)[0]}).attr("cy",function(t){return o.projection(t)[1]}).attr("r",r).attr("id",e).attr("fill",n)}},{key:"getMyLocation",value:function(){var t=this;navigator.geolocation.getCurrentPosition(function(e){t.createDot([e.coords.longitude,e.coords.latitude],"my-location","green","5px")})}},{key:"zoomed",value:function(){this.g.attr("transform","translate("+d3.event.translate.join(",")+")scale("+d3.event.scale+")"),this.g.selectAll("circle").attr("d",this.path.projection(this.projection)),this.g.selectAll("path").attr("d",this.path.projection(this.projection))}},{key:"filterRoutes",value:function(t){var e=this;_(this.muni).map(function(t){return"#b"+t._id}).each(function(t){e.g.selectAll(t).attr("opacity",1)}),_(this.muni).filter(function(e){return t&&e._routeTag!==t}).map(function(t){return"#b"+t._id}).each(function(t){e.g.selectAll(t).attr("opacity",0)})}}]),t}();e.MainController=p}]),angular.module("codeChallenge").run(["$templateCache",function(t){t.put("app/main/main.html",'<div id="map"></div><div class="routes"><button ng-click="main.filterRoutes(main.chosenRoute=\'\')" class="btn btn-default">Clear Filter</button><div><select ng-model="main.chosenRoute" ng-change="main.filterRoutes(main.chosenRoute)" class="form-control"><option value="">No Filter</option><option value="{{route}}" ng-repeat="route in main.routes">{{route}}</option></select></div></div>')}]);
//# sourceMappingURL=../maps/scripts/app-bdabc406ed.js.map
